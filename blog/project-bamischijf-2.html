<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="/">
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {

                    colors: {
                        primary: tailwind.colors.blue
                    },
                },},
                }
    </script>


    </head>

<body class="bg-gray-950 font-serif text-gray-200"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0 "><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a href><div class="flex items-center justify-between"><div class=" h-6 text-2xl font-semibold sm:block text-primary-800">Bruuteuzius Blogged</div></div></a></div>
    <div class="flex items-center space-x-4 leading-5 sm:space-x-6"><a href="" class="hidden font-medium text-gray-100 sm:block">Home
                </a><a href="tags" class="hidden font-medium text-gray-100 sm:block">Tags
                </a><a href="books" class="hidden font-medium text-gray-100 sm:block">Books
                </a><a href="til" class="hidden font-medium text-gray-100 sm:block">TIL
                </a><a href="https://github.com/bruuteuzius" class="hidden font-medium text-gray-100 sm:block">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-400 h-6 w-6 fill-current text-gray-200"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><button id="toggle-button" aria-label="Toggle Menu" class="sm:hidden"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-8 w-8 text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button>
        <div id="mobile-menu" class="fixed left-0 top-0 z-10 h-full w-full translate-x-full transform   duration-300 ease-in-out bg-gray-950 opacity-[0.98]"><div class="flex justify-end"><button id="close-mobile-menu-button" class="mr-8 mt-11 h-8 w-8" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div>
            <nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a href="" class="text-2xl font-bold tracking-widest text-gray-100">Home
                            </a></div><div class="px-12 py-4"><a href="tags" class="text-2xl font-bold tracking-widest text-gray-100">Tags
                            </a></div><div class="px-12 py-4"><a href="books" class="text-2xl font-bold tracking-widest text-gray-100">Books
                            </a></div><div class="px-12 py-4"><a href="til" class="text-2xl font-bold tracking-widest text-gray-100">TIL
                            </a></div><div class="px-12 py-4"><a href="https://github.com/bruuteuzius" class="text-2xl font-bold tracking-widest text-gray-100">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-400 h-6 w-6 fill-current text-gray-200"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div></nav></div></div></header>
<script>
//👎 but what can I do? It's a static html. I can't use C# here.
 const toggleMobileMenu = () => document.querySelector('#mobile-menu').classList.toggle('translate-x-full');
 
 document.querySelector('#toggle-button').addEventListener('click', toggleMobileMenu);
 document.querySelector('#close-mobile-menu-button').addEventListener('click', toggleMobileMenu);
</script>
        <center><img src="imgs/updated_wrong.png" width="80%"></center> 
        
        <main class="mb-auto"><article><div class="xl:divide-y  xl:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt>
                        <dd class="text-base font-medium leading-6 text-gray-400"><time datetime="2025-09-09T00:00:00.000">September 9, 2025</time></dd></div></dl>
                <div class="prose prose-invert mx-auto"><h1 class>Project bamischijf 2.0</h1></div></div></header>
        <div class="grid-rows-[auto_1fr] divide-y  pb-8 divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0"><dl class="pb-10 pt-6 xl:border-b  xl:pt-11 xl:border-gray-700"><dt class="sr-only">Authors</dt>
                <dd><ul class="flex flex-wrap justify-center gap-4 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt>
                                        <dd class="text-gray-900 dark:text-gray-100 flex gap-1 items-center">bruuteuzius<a target="_blank" rel="noopener noreferrer" href="https://github.com/bruuteuzius" class="flex gap-1 items-center text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-400 w-4 h-4 fill-current text-gray-200"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></dd></dl></li></ul></dd></dl>
            <div class="divide-y  divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose prose-invert max-w-none pb-8 pt-10"><h2 id="project-bamischijf-2.0">Project bamischijf 2.0</h2>
<p>Mijn huidige NAS heet bamischijf en is een DS920+ van Synology. Maar de 4x4TB in SHR2 zit nu op 80% volheid en na
<a href="https://www.tomshardware.com/pc-components/nas/synology-requires-self-branded-drives-for-some-consumer-nas-systems-drops-full-functionality-and-support-for-third-party-hdds">deze</a>
stunt van Synology wil ik eigenlijk geen Synology meer maar mn eigen zelfbouw NAS.
De keuze is gevallen op een Jonsbo N2. Hier heb ik 3x16TB HDD's in, een Intel i5 13500 met 14 cores, 64GB aan geheugen en een 500GB SSD voor het OS.
Het gigabyte moederbord heeft 4 SATA stekkers wat voor nu genoeg is.</p>
<blockquote>
<p><strong><em>Dikke tip :</em></strong>
De fan die bij de jonsbo zit, niet aansluiten onder de molex stekkers maar op het moederbord, zodat je de snelheid kan reguleren.</p>
</blockquote>
<h2 id="het-plan">Het plan</h2>
<p>Zoals <a href="https://jrs-s.net/2025/08/11/rustdesk-server-on-ubuntu-22-04/">Jim Salter</a> het mooi zegt : <em>As usual, I’m self-documenting a project while I work on it</em> Dat spreekt me wel enorm aan want ik ben niet zo goed in plannen. Ik doe liever.
Kortom, er is geen plan. Ik kan wel een lijstje maken met wat ik nu aan apps, scripts en functionaliteiten op de Synology heb en wat ik straks op
mijn nieuwe server wil, of nodig ga hebben.</p>
<ul>
<li>DSM 7 als frontend om in te klikken</li>
<li>SHR2 (een soort RAID5)</li>
<li>Shared Folders (zoals backupgs, downloads, web, docker, homes)</li>
<li>file services (AFP voor Mac, NFS, SMB)</li>
<li>home dirs met daarin o.a. foto's</li>
<li>apps (zoals synology drive client)</li>
<li>docker containers</li>
<li>media en backups</li>
<li>scripts in de task scheduler</li>
<li>firewall</li>
<li>notificatie mogelijkheden</li>
<li>verbinding met UPS</li>
<li>fan control</li>
<li>server monitoring</li>
</ul>
<h2 id="stap-1-de-server-installeren">Stap 1 : De server installeren</h2>
<p>OpenMediaVault gaat mijn frontend worden ipv DSM 7. Het is ook mogelijk om DSM op een niet-Synology te installeren, maar dat voelt als cheaten en lijkt me niet wat.</p>
<blockquote>
<p><em>21-09-2025 Zie struikelblok 1 verderop. Installeer dus debian 12!</em></p>
</blockquote>
<p>En OMV heeft debian nodig dus tsja. Ondertussen heb ik een usb stick met Debian 12 gemaakt. Ik gebruik op mijn laptop KDE Iso Writer. Die vraagt om een checksum.
Een checksum van je iso pakken doe je zo :</p>
<pre><code>sha256sum debian12.iso
</code></pre>
<p>Het resultaat daarvan plak je in de tool en hoppaaa usb stickie bakken. Dat is cheaten want je moet op de website de sha vinden, maar dat lukte dus niet :)</p>
<h3 id="ssh">SSH</h3>
<p>Nu de server een debian install heeft, moet ik nog een openssh server draaien.</p>
<pre><code>sudo apt install openssh-server
</code></pre>
<p>en daarna starten met <code>sudo systemctl start ssh</code> en dan de service enablen zodat ie na een herstart <code>sudo systemctl enable ssh</code>.
Draait de ssh service? <code>sudo systemctl status ssh</code> Dan kan de server in de kast boven het voorraadhok.
Het enige dat de server nodig heeft is stroom en een UTP kabeltje.</p>
<h3 id="vast-ip-adres">Vast ip adres</h3>
<p>Eerst maar eens een update doen.</p>
<pre><code>sudo apt update
</code></pre>
<p>bjdiedering is not in the sudoers file. Okeeeeej. Nouwja ook wel fijn dat niet alles aan staat en ik zelf ook wat moet doen.
<code>bjdiedering ALL=(ALL:ALL) ALL</code> toevoegen aan <code>/etc/sudoers</code> en klaar.</p>
<pre><code>sudo apt install net-tools dnsutils iproute2 nano
</code></pre>
<p>En dan een static ip adres in <code>/etc/network/interfaces</code> (eerst backup maken!)</p>
<pre><code>auto eno1
allow-hotplug eno1
iface eno1 inet static
    address 192.168.178.200
    netmask 255.255.255.0
    gateway 192.168.178.1
    dns-nameservers 8.8.8.8 8.8.4.4
</code></pre>
<p>Misschien nog een keer niet-google dns-en, maar soit.
Daar netwerk restarten:</p>
<pre><code>sudo systemctl restart networking
</code></pre>
<h3 id="firewall">Firewall</h3>
<p>Nu wil ik een firewall. Ik heb ergens gelezen dat OpenMediaVault ufw ondersteund, maar ik heb ook gelezen dat die niet lief
samen speelt met docker. Maar dat lijkt me een later zorg.
Eerst maar eens <code>sudo apt install ufw</code>. Dan een backup maken van de basis met <code>sudo cp /etc/default/ufw /etc/default/ufw.backup</code> en <code>sudo cp -r /etc/ufw /etc/ufw.backup</code>
Ik wil nog wel kunnen ssh-en dus <code>sudo ufw add ssh</code>
En een paar basis rules :</p>
<pre><code>sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw default deny forward
</code></pre>
<p>Aanzetten en we zijn safe <code>sudo ufw enable</code></p>
<h3 id="monitoring">Monitoring</h3>
<p>Eerst maar eens snel de temps monitoren.</p>
<pre><code>sudo apt install lm-sensors
</code></pre>
<p>Daarna de sensors vragenlijst starten met <code>sudo sensors-detect</code> en daarna kun je met <code>sensors</code> zien wat o.a. de temps zijn.</p>
<p><img src="Content/Blog/media/nasischijftemp.png" alt="" /></p>
<p>De nasischijf staat al een tijdje in de kast dus dit zijn goeie temps voor een ding dat niet zoveel doet :)</p>
<p>Maar om nu iedere keer te ssh-en en kijken wat o.a. de temperatuur is van alles, ga ik toch liever naar mn grafana dashboard.
Dus we gaan node-exporter installeren :</p>
<pre><code>sudo apt install prometheus-node-exporter
</code></pre>
<p>Dan nog de node-exporter poort 9100 toevoegen aan ufw en klaar is Bert <code>sudo ufw allow 9100/tcp</code></p>
<p><img src="Content/Blog/media/node-exporter.png" alt="" /></p>
<p>Hierna heb ik de prometheus.yml op mn oude NAS (bamischijf 1.0) aangepast, <code>docker restart prometheus</code> en ik kan de metric toevoegen:
<img src="Content/Blog/media/grafanatemp.png" alt="" /></p>
<p>Misschien is 25,6 graden niet helemaal zuiver de gemiddelde temperatuur, maar alleszins de temp van teminste 1 CPU core. Mooi woord : alleszins.</p>
<h3 id="struikelblok-1">Struikelblok 1</h3>
<p>Ik dacht : ik installeer debian 13 want die is de nieuwste. Kom ik er net op dit punt achter dat OpenMediaVault nog niet wordt ondersteund
door <a href="https://docs.openmediavault.org/en/latest/releases.html">debian 13</a>... Dus ik ga denk ik maar weer opnieuw een installatie doen,
maar dan met OpenMediaVault 7 met debian12. Zodra OpenMediaVault 8 klaar is, kan ik upgraden naar debian13.</p>
<h3 id="openmediavault">OpenMediaVault</h3>
<p>De installatiehandleiding kan ik niet veel meer van maken dan wat <a href="https://docs.openmediavault.org/en/latest/installation/on_debian.html">hier</a> staat.
Niet vergeten om na de installatie van OMW mezelf toe te voegen als iemand die mag ssh-en: <code>sudo usermod -a -G _ssh bjdiedering</code>
Er staat namelijk duidelijk in de installatie handleiding dat door het installeren van OMV de user die tijdens het installeren
van debian is aangemaakt, niet perse kan ssh-en.</p>
<p>Na een reboot, naar <a href="http://192.168.178.200">http://192.168.178.200</a> en we krijgen een mooi loginscherm te zien :</p>
<p><img src="Content/Blog/media/myfirstomv.png" alt="" /></p>
<p>Let the fun begin! Voor nu deze post committen naar mn github repo, zodat de blogpost wordt bijgewerkt.</p>
<h4 id="plugins">Plugins</h4>
<p>Laten we beginnen met DNS instellen in de GUI want anders kan ik niet wgetten vanaf een terminal. Klik op Netwerk, Interfaces,
klik op je netwerk-kaart (bij mij was dat eno1), scroll naar beneden en vul een DNS in. Bijvoorbeeld 8.8.8.8 (van google) of 1.1.1.1 (cloudflare)
Nu kun je in je terminal :</p>
<pre><code>wget -O - https://github.com/OpenMediaVault-Plugin-Developers/packages/raw/master/install | bash
</code></pre>
<p>Als je DNS niet instelt, krijg je deze foutmelding :
<code>Resolving github.com (github.com)... failed: Temporary failure in name resolution. wget: unable to resolve host address ‘github.com’</code></p>
<h4 id="zfs">ZFS</h4>
<p>Nadat omv-extras is geinstalleerd: refresh de pagina en zoek onder Plugins naar de plugin <strong>openmediavault-kernel</strong> en installeer deze.
De proxmox kernel is maximaal stabiel en handig als je stabiele ZFS wil draaien heb ik ergens gelezen.
Ga nu (na de page refresh) naar System, Kernel, en kies uit de dropdown de nieuwste proxmox kernel :
<img src="Content/Blog/media/proxmox-kernel.png" alt="" />
Kies een proxmox kernel en zet die als boot. De proxmox kernels eindigen met -pve</p>
<p>Installeer nu <strong>openmediavault-zfs</strong>. Refresh de pagina weer en ga via Storage naar zfs. Nu moet je dus een naam gaan kiezen.
Iedereen op de interwebs kiest voor &quot;tank&quot;. Maar ik dacht eerst aan &quot;deadpool&quot;. Maar dat is luguber. Terwijl het misschien wel goed is.
Deadpool kan iig niet dood.... Kies een naam, kies het type van de pool (ik heb RAID-Z1), kies de disks waar je de pool mee wil maken.
Ik heb 3 disks van 16TB. Vanwege RAID-Z1 krijg heb ik 1 disk voor pariteit en ongeveer 2 disks voor data.
Technisch gezien zou de totale capaciteit 32 TB moeten zijn, maar de 29TB snap ik ook wel. Ik heb ashift op <code>12</code> gezet en compression op <code>lz4</code>.
Nu de pool bestaat kan ik een paar filesystems toevoegen zoals backups.</p>
<p><img src="Content/Blog/media/filesystem-backups.png" alt="" /></p>
<p>Tijd om een kopieer-test uit te voeren.
Laat ik eens een SQL Server backup rsync-en van bamischijf naar de nasischijf. Maar dan ben ik niet zo heel erg blij met de overdrachtsnelheid...
Ook al gebruik ik compressie en staan de NASen dicht bij elkaar en zit er een gigabit switch tussen... hier gaat iets niet goed:
<img src="Content/Blog/media/copy-backup-from-bamischijf.png" alt="" />
Dat is toch erg?! 17mb/s! Dat gaat voor 10TB aan data (10.000.000mb / 17) = 588235 seconden duren! Ofwel 163 uur! Ofwel 6,8 dagen!
Gelukkig had ik dit van tevoren bedacht en heb ik 2x USB 3.0 naar 2.5gb adapters gekocht. Die ga ik in beide NASsen prikken, statisch IP adres koppelen en Bob is uwen oom.
In theorie... wordt vervolgd!</p>
</div>
                <div class="pb-6 pt-6 text-sm text-gray-300"><a target="_blank" rel="noopener noreferrer" href="https://github.com/bruuteuzius/tree/main/Content/Blog/project-bamischijf-2">View on GitHub</a></div></div>
            <footer><div class=" text-sm font-medium leading-5 divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-400">Tags</h2>
                        <div class="flex flex-wrap"><a class="text-primary-500 hover:text-primary-400 mr-3 text-sm font-medium uppercase" href="tags/homelab">homelab</a></div></div></div>
                <div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-400" aria-label="Back to the home" href>← Back to the home</a></div></footer></div></div></article></main>

        <footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/bruuteuzius"><span class="sr-only">github</span>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-400 h-6 w-6 fill-current text-gray-200"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div>
                <div class="mb-2 flex space-x-2 text-sm text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/BlazorStatic/BlazorStatic"> Built with Blazor Static</a>
                    <div>•</div>
                    <div>© 2025</div></div></div></footer></div></div>
        <blazor-focus-on-navigate selector="h1"></blazor-focus-on-navigate></body></html>