<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="/">
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {

                    colors: {
                        primary: tailwind.colors.blue
                    },
                },},
                }
    </script>


    </head>

<body class="bg-gray-950 font-serif text-gray-200"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0 "><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a href><div class="flex items-center justify-between"><div class=" h-6 text-2xl font-semibold sm:block text-primary-800">Bruuteuzius Blogged</div></div></a></div>
    <div class="flex items-center space-x-4 leading-5 sm:space-x-6"><a href="" class="hidden font-medium text-gray-100 sm:block">Home
                </a><a href="tags" class="hidden font-medium text-gray-100 sm:block">Tags
                </a><a href="books" class="hidden font-medium text-gray-100 sm:block">Books
                </a><a href="til" class="hidden font-medium text-gray-100 sm:block">TIL
                </a><a href="https://github.com/bruuteuzius" class="hidden font-medium text-gray-100 sm:block">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-400 h-6 w-6 fill-current text-gray-200"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><button id="toggle-button" aria-label="Toggle Menu" class="sm:hidden"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-8 w-8 text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button>
        <div id="mobile-menu" class="fixed left-0 top-0 z-10 h-full w-full translate-x-full transform   duration-300 ease-in-out bg-gray-950 opacity-[0.98]"><div class="flex justify-end"><button id="close-mobile-menu-button" class="mr-8 mt-11 h-8 w-8" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div>
            <nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a href="" class="text-2xl font-bold tracking-widest text-gray-100">Home
                            </a></div><div class="px-12 py-4"><a href="tags" class="text-2xl font-bold tracking-widest text-gray-100">Tags
                            </a></div><div class="px-12 py-4"><a href="books" class="text-2xl font-bold tracking-widest text-gray-100">Books
                            </a></div><div class="px-12 py-4"><a href="til" class="text-2xl font-bold tracking-widest text-gray-100">TIL
                            </a></div><div class="px-12 py-4"><a href="https://github.com/bruuteuzius" class="text-2xl font-bold tracking-widest text-gray-100">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-400 h-6 w-6 fill-current text-gray-200"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div></nav></div></div></header>
<script>
//üëé but what can I do? It's a static html. I can't use C# here.
 const toggleMobileMenu = () => document.querySelector('#mobile-menu').classList.toggle('translate-x-full');
 
 document.querySelector('#toggle-button').addEventListener('click', toggleMobileMenu);
 document.querySelector('#close-mobile-menu-button').addEventListener('click', toggleMobileMenu);
</script>
        <center><img src="imgs/updated_wrong.png" width="80%"></center> 
        
        <main class="mb-auto"><article><div class="xl:divide-y  xl:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt>
                        <dd class="text-base font-medium leading-6 text-gray-400"><time datetime="2025-09-09T00:00:00.000">September 9, 2025</time></dd></div></dl>
                <div class="prose prose-invert mx-auto"><h1 class>Project bamischijf 2.0</h1></div></div></header>
        <div class="grid-rows-[auto_1fr] divide-y  pb-8 divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0"><dl class="pb-10 pt-6 xl:border-b  xl:pt-11 xl:border-gray-700"><dt class="sr-only">Authors</dt>
                <dd><ul class="flex flex-wrap justify-center gap-4 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt>
                                        <dd class="text-gray-900 dark:text-gray-100 flex gap-1 items-center">bruuteuzius<a target="_blank" rel="noopener noreferrer" href="https://github.com/bruuteuzius" class="flex gap-1 items-center text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-400 w-4 h-4 fill-current text-gray-200"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></dd></dl></li></ul></dd></dl>
            <div class="divide-y  divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose prose-invert max-w-none pb-8 pt-10"><h2 id="project-bamischijf-2.0">Project bamischijf 2.0</h2>
<p>Mijn huidige NAS heet bamischijf en is een DS920+ van Synology. Maar de 4x4TB in SHR2 zit nu op 80% volheid en na
<a href="https://www.tomshardware.com/pc-components/nas/synology-requires-self-branded-drives-for-some-consumer-nas-systems-drops-full-functionality-and-support-for-third-party-hdds">deze</a>
stunt van Synology wil ik eigenlijk geen Synology meer maar mn eigen zelfbouw NAS.
De keuze is gevallen op een Jonsbo N2. Hier heb ik 3x16TB HDD's in, een Intel i5 13500 met 14 cores, 64GB aan geheugen en een 500GB SSD voor het OS.
Het gigabyte moederbord heeft 4 SATA stekkers wat voor nu genoeg is.</p>
<blockquote>
<p><strong><em>Dikke tip :</em></strong>
De fan die bij de jonsbo zit, niet aansluiten onder de molex stekkers maar op het moederbord, zodat je de snelheid kan reguleren.</p>
</blockquote>
<h2 id="het-plan">Het plan</h2>
<p>Zoals <a href="https://jrs-s.net/2025/08/11/rustdesk-server-on-ubuntu-22-04/">Jim Salter</a> het mooi zegt : <em>As usual, I‚Äôm self-documenting a project while I work on it</em> Dat spreekt me wel enorm aan want ik ben niet zo goed in plannen. Ik doe liever.
Kortom, er is geen plan. Ik kan wel een lijstje maken met wat ik nu aan apps, scripts en functionaliteiten op de Synology heb en wat ik straks op
mijn nieuwe server wil, of nodig ga hebben.</p>
<ul>
<li>DSM 7 als frontend om in te klikken</li>
<li>SHR2 (een soort RAID5)</li>
<li>Shared Folders (zoals backups, downloads, web, docker, homes)</li>
<li>file services (AFP voor Mac, NFS, SMB)</li>
<li>home dirs met daarin o.a. foto's</li>
<li>apps (zoals synology drive client)</li>
<li>docker containers</li>
<li>media en backups</li>
<li>scripts in de task scheduler</li>
<li>firewall</li>
<li>notificatie mogelijkheden</li>
<li>verbinding met UPS</li>
<li>fan control</li>
<li>server monitoring</li>
</ul>
<h2 id="stap-1-de-server-installeren">Stap 1 : De server installeren</h2>
<p>Boven onze voorraadkast in de gang, had ik nog een loze ruimte. Deze ruimte is naast de meterkast, dus het leek me een mooie plek
voor mijn servers. De Frigate-server (een Beelink EQ14) staat er al, mijn nasischijf kan er prima naast :</p>
<p><img src="Content/Blog/media/nasischijf.jpeg" alt="" />
<em>Vet he? Ik heb die houten plaat weggeschroeft, kit er omheen weggesneden en een paar keukenkastjes-scharnieren gebruikt, om een deurtje te maken. Nu valt het niet op dat er iets achter zit, en als ik er bij moet dan kan dat :)</em></p>
<p>OpenMediaVault gaat mijn frontend worden ipv DSM 7. Het is ook mogelijk om DSM op een niet-Synology te installeren, maar dat voelt als cheaten en lijkt me niet wat.</p>
<blockquote>
<p><em>21-09-2025 Zie struikelblok 1 verderop. Installeer dus debian 12!</em></p>
</blockquote>
<p>En OMV heeft debian nodig dus tsja. Ondertussen heb ik een usb stick met Debian 12 gemaakt. Ik gebruik op mijn laptop KDE Iso Writer. Die vraagt om een checksum.
Een checksum van je iso pakken doe je zo :</p>
<pre><code>sha256sum debian12.iso
</code></pre>
<p>Het resultaat daarvan plak je in de tool en hoppaaa usb stickie bakken. Dat is cheaten want je moet op de website de sha vinden, maar dat lukte dus niet :)</p>
<h3 id="ssh">SSH</h3>
<p>Nu de server een debian install heeft, moet ik nog een ssh server draaien.</p>
<pre><code>sudo apt install openssh-server
</code></pre>
<p>en daarna starten met <code>sudo systemctl start ssh</code> en dan de service enablen zodat ie na een herstart <code>sudo systemctl enable ssh</code>.
Draait de ssh service? <code>sudo systemctl status ssh</code> Dan kan de server in de kast boven het voorraadhok.
Het enige dat de server nodig heeft is stroom en een UTP kabeltje.</p>
<h3 id="vast-ip-adres">Vast ip adres</h3>
<p>Eerst maar eens een update doen.</p>
<pre><code>sudo apt update
</code></pre>
<p>bjdiedering is not in the sudoers file. Okeeeeej. Nouwja ook wel fijn dat niet alles aan staat en ik zelf ook wat moet doen.
<code>bjdiedering ALL=(ALL:ALL) ALL</code> toevoegen aan <code>/etc/sudoers</code> en klaar.</p>
<pre><code>sudo apt install net-tools dnsutils iproute2 nano
</code></pre>
<p>En dan een static ip adres in <code>/etc/network/interfaces</code> (eerst backup maken!)</p>
<pre><code>auto eno1
allow-hotplug eno1
iface eno1 inet static
    address 192.168.178.200
    netmask 255.255.255.0
    gateway 192.168.178.1
    dns-nameservers 8.8.8.8 8.8.4.4
</code></pre>
<p>Misschien nog een keer niet-google dns-en, maar soit.
Daar netwerk restarten:</p>
<pre><code>sudo systemctl restart networking
</code></pre>
<h3 id="firewall">Firewall</h3>
<p>Nu wil ik een firewall. Ik heb ergens gelezen dat OpenMediaVault ufw ondersteund, maar ik heb ook gelezen dat die niet lief
samen speelt met docker. Maar dat lijkt me een later zorg.
Eerst maar eens <code>sudo apt install ufw</code>. Dan een backup maken van de basis met <code>sudo cp /etc/default/ufw /etc/default/ufw.backup</code> en <code>sudo cp -r /etc/ufw /etc/ufw.backup</code>
Ik wil nog wel kunnen ssh-en dus <code>sudo ufw add ssh</code>
En een paar basis rules :</p>
<pre><code>sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw default deny forward
</code></pre>
<p>Aanzetten en we zijn safe <code>sudo ufw enable</code></p>
<h3 id="monitoring">Monitoring</h3>
<p>Eerst maar eens snel de temps monitoren.</p>
<pre><code>sudo apt install lm-sensors
</code></pre>
<p>Daarna de sensors vragenlijst starten met <code>sudo sensors-detect</code> en daarna kun je met <code>sensors</code> zien wat o.a. de temps zijn.</p>
<p><img src="Content/Blog/media/nasischijftemp.png" alt="" /></p>
<p>De nasischijf staat al een tijdje in de kast dus dit zijn goeie temps voor een ding dat niet zoveel doet :)</p>
<p>Maar om nu iedere keer te ssh-en en kijken wat o.a. de temperatuur is van alles, ga ik toch liever naar mn grafana dashboard.
Dus we gaan node-exporter installeren :</p>
<pre><code>sudo apt install prometheus-node-exporter
</code></pre>
<p>Dan nog de node-exporter poort 9100 toevoegen aan ufw en klaar is Bert <code>sudo ufw allow 9100/tcp</code></p>
<p><img src="Content/Blog/media/node-exporter.png" alt="" /></p>
<p>Hierna heb ik de prometheus.yml op mn oude NAS (bamischijf 1.0) aangepast, <code>docker restart prometheus</code> en ik kan de metric toevoegen:
<img src="Content/Blog/media/grafanatemp.png" alt="" /></p>
<p>Misschien is 25,6 graden niet helemaal zuiver de gemiddelde temperatuur, maar alleszins de temp van teminste 1 CPU core. Mooi woord : alleszins.</p>
<h3 id="struikelblok-1">Struikelblok 1</h3>
<p>Ik dacht : ik installeer debian 13 want die is de nieuwste. Kom ik er net op dit punt achter dat OpenMediaVault nog niet wordt ondersteund
door <a href="https://docs.openmediavault.org/en/latest/releases.html">debian 13</a>... Dus ik ga denk ik maar weer opnieuw een installatie doen,
maar dan met OpenMediaVault 7 met debian12. Zodra OpenMediaVault 8 klaar is, kan ik upgraden naar debian13.</p>
<h3 id="openmediavault">OpenMediaVault</h3>
<p>De installatiehandleiding kan ik niet veel meer van maken dan wat <a href="https://docs.openmediavault.org/en/latest/installation/on_debian.html">hier</a> staat.
Niet vergeten om na de installatie van OMW mezelf toe te voegen als iemand die mag ssh-en: <code>sudo usermod -a -G _ssh bjdiedering</code>
Er staat namelijk duidelijk in de installatie handleiding dat door het installeren van OMV de user die tijdens het installeren
van debian is aangemaakt, niet perse kan ssh-en.</p>
<p>Na een reboot, naar <a href="http://192.168.178.200">http://192.168.178.200</a> en we krijgen een mooi loginscherm te zien :</p>
<p><img src="Content/Blog/media/myfirstomv.png" alt="" /></p>
<p>Let the fun begin! Voor nu deze post committen naar mn github repo, zodat de blogpost wordt bijgewerkt.</p>
<h4 id="plugins">Plugins</h4>
<p>Laten we beginnen met DNS instellen in de GUI want anders kan ik niet wgetten vanaf een terminal. Klik op Netwerk, Interfaces,
klik op je netwerk-kaart (bij mij was dat eno1), scroll naar beneden en vul een DNS in. Bijvoorbeeld 8.8.8.8 (van google) of 1.1.1.1 (cloudflare)
Nu kun je in je terminal :</p>
<pre><code>wget -O - https://github.com/OpenMediaVault-Plugin-Developers/packages/raw/master/install | bash
</code></pre>
<p>Als je DNS niet instelt, krijg je deze foutmelding :
<code>Resolving github.com (github.com)... failed: Temporary failure in name resolution. wget: unable to resolve host address ‚Äògithub.com‚Äô</code></p>
<h4 id="zfs">ZFS</h4>
<p>Nadat omv-extras is geinstalleerd: refresh de pagina en zoek onder Plugins naar de plugin <strong>openmediavault-kernel</strong> en installeer deze.
De proxmox kernel is maximaal stabiel en handig als je stabiele ZFS wil draaien heb ik ergens gelezen.
Ga nu (na de page refresh) naar System, Kernel, en kies uit de dropdown de nieuwste proxmox kernel :
<img src="Content/Blog/media/proxmox-kernel.png" alt="" />
Kies een proxmox kernel en zet die als boot. De proxmox kernels eindigen met -pve</p>
<p>Installeer nu <strong>openmediavault-zfs</strong>. Refresh de pagina weer en ga via Storage naar zfs. Nu moet je dus een naam gaan kiezen.
Iedereen op de interwebs kiest voor &quot;tank&quot;. Maar ik dacht eerst aan &quot;deadpool&quot;. Maar dat is luguber. Terwijl het misschien wel goed is.
Deadpool kan iig niet dood.... Kies een naam, kies het type van de pool (ik heb RAID-Z1), kies de disks waar je de pool mee wil maken.
Ik heb 3 disks van 16TB. Vanwege RAID-Z1 krijg heb ik 1 disk voor pariteit en ongeveer 2 disks voor data.
Technisch gezien zou de totale capaciteit 32 TB moeten zijn, maar de 29TB snap ik ook wel. Ik heb ashift op <code>12</code> gezet en compression op <code>lz4</code>.
Nu de pool bestaat kan ik een paar filesystems toevoegen zoals backups.</p>
<p><img src="Content/Blog/media/filesystem-backups.png" alt="" /></p>
<p>Ik ben er achter gekomen dat als je bijvoorbeeld een NFS of SMB share wil maken, dat je daarvoor eerst een Shared Folder moet maken.
De filesystems die ik heb gemaakt, ga ik ook shared folders voor maken. Als je van het filesystem <code>/pool/backups</code> een shared folder wil maken,
is het aan te raden om het relative path <strong>niet</strong> <code>/backups/</code> te maken, maar <code>/</code> want anders krijg je <code>/pool/backups/backups</code> als shared folder.</p>
<p>Tijd om een kopieer-test uit te voeren.
Laat ik eens een SQL Server backup rsync-en van bamischijf naar de nasischijf. Maar dan ben ik niet zo heel erg blij met de overdrachtsnelheid...
Ook al gebruik ik compressie en staan de NASen dicht bij elkaar en zit er een gigabit switch tussen... hier gaat iets niet goed:</p>
<p><img src="Content/Blog/media/copy-backup-from-bamischijf.png" alt="" /></p>
<p>Dat is toch erg?! 17mb/s! Dat gaat voor 10TB aan data (10.000.000mb / 17) = 588235 seconden duren! Ofwel 163 uur! Ofwel 6,8 dagen!
Gelukkig had ik dit van tevoren bedacht en heb ik 2x USB 3.0 naar 2.5gb adapters <a href="https://www.amazon.nl/dp/B0CW5YP9BC?ref=ppx_yo2ov_dt_b_fed_asin_title">gekocht</a>. Die ga ik in beide NASsen prikken, statisch IP adres koppelen en Bob is uwen oom.
In theorie... wordt vervolgd!</p>
<blockquote>
<p><em>28-09-2025 ondertussen de 2.5g adapters tussen de Synology en de Jonsbo geprikt, met een cat6a kabel</em></p>
</blockquote>
<h4 id="netwerk-kopieer-snelheid">Netwerk kopieer snelheid</h4>
<p>Ok dus ik heb de adapters aangesloten en de kabel zit ertussen. Eerst maar eens kijken of de usb apparaten herkend worden met <code>lsusb</code> en tattaaaaaa :</p>
<p><img src="Content/Blog/media/realtek-usb-ethernet.png" alt="" /></p>
<p>In OMV is het makkelijk, interface toevoegen via Network, Interfaces, Create.</p>
<ol>
<li>Kies een device (enx00nogwat)</li>
<li>Kies method Static</li>
<li>Kies een adres : 192.168.100.1</li>
<li>Kies dezelfde netmask als de andere interface : 255.255.255.0</li>
<li>We hebben geen gateway nodig want we gaan toch net internet niet op.</li>
<li>Scroll naar onder naar Advanced Settings en kies MTU 9000 (inderdaad : jumbo frames)</li>
<li>Akkordeer de wijzigingen en we zijn goed om te gaan!</li>
</ol>
<p>In Synology is het wat lastiger. Gelukkig zijn er velen mij voorgegaan in een <a href="https://github.com/bb-qq/r8152">oplossing</a> als dit met een USB adapter.</p>
<ol>
<li>Omdat ik een Synology DS920+ heb, met <em>gemini</em> chipset, moet ik deze downloaden : <a href="https://github.com/bb-qq/r8152/releases/download/2.20.1-1/r8152-geminilake-2.20.1-1_7.2.spk">https://github.com/bb-qq/r8152/releases/download/2.20.1-1/r8152-geminilake-2.20.1-1_7.2.spk</a></li>
<li>de gedownload .spk onder Package Management een manual install doen.</li>
<li>Vinkje voor <em>Run af ter installation</em> uitvinken.</li>
<li>Dat faalt, dat was verwacht, daarom deze opdracht uitvoeren : <code> sudo install -m 4755 -o root -D /var/packages/r8152/target/r8152/spk_su /opt/sbin/spk_su</code></li>
<li>Daarna opnieuw proberen, runnen en klaarrrr
<img src="Content/Blog/media/rtl8152-spk.png" alt="" /></li>
<li>Nu is er ook een extra netwerk interface bijgekomen, onder Control Panel, Network : een <strong>LAN 3</strong></li>
<li>Edit de waarden onder Use Manual Configuration :
8. IP = 192.168.100.2
9. zelfde subnet mask 255.255.255.0
10. geen gateway en DNS
11. MTU ook hier op 9000 zetten.</li>
<li>Klaar!</li>
</ol>
<p>Nu wordt het tijd om nog eens een kopieer-actie te doen.</p>
<p><img src="Content/Blog/media/twee-en-een-half-giegelbits.png" alt="" /></p>
<p>Nouw, kijk, dat gaat al een stuk sneller toch? Eens kijken wat iperf te melden heeft :</p>
<pre><code># Op bamischijf
iperf3 -s

# Op nasischijf
iperf3 -c 192.168.100.2
</code></pre>
<p>Et voila :</p>
<p><img src="Content/Blog/media/iperf-c-nasischijf.png" alt="" /></p>
<p>2,88gb aan data in 10 seconden. Whoop whoop :)</p>
<p>Maar waarom heb ik dan nog steeds een data-transfer snelheid van ongeveer 100MB per seconde?
Laat ik eens een andere mogelijke bottleneck (de disks) met <code>hdparm</code> onderzoeken op nasischijf :
<img src="Content/Blog/media/hdparm-nasischijf.png" alt="" /></p>
<p>En op bamischijf (Synology) de benchmark op 1 van de schijven :
<img src="Content/Blog/media/benchmark-bamischijf-disk1.png" alt="" /></p>
<p>Dus bamischijf is de bottleneck met zn disk snelheid...
Oh well... dan maar 100MB per seconde.</p>
<h4 id="extras">extra's</h4>
<p>Ondertussen heb ik ook wat vette plugins gevonden vanuit <a href="https://wiki.omv-extras.org/doku.php?id=start">omv-extra's</a> :</p>
<ul>
<li>filebrowser : want soms is het gewoon prettig om bestanden te verplaatsen of renamen met de muis (net zoals in DSM 7)</li>
<li>nut : want zodra alle data over gezet is, moet nasischijf ook aangesloten worden op mijn <a href="https://www.bol.com/nl/nl/p/apc-back-ups-950va-noodstroomvoeding-4x-stopcontact">UPS</a>.</li>
<li>scripts : ik heb nu ook scripts die ik op een schedule uitvoer. Maar misschien moet ik hier ook nog maar cron-jobs voor maken...</li>
<li>snmp : ik heb nu op mijn synology ook SNMP en daar haal ik vrij veel systeem-informatie uit voor een Grafana dashboard.</li>
</ul>
<p>Ik zat nog te denken aan onedrive plugin, maar dan hang ik weer aan een grote cloudprovider en dat wil ik juist niet.</p>
<h4 id="notificaties">Notificaties!</h4>
<p>Owja als er stront aan de spreekwoordelijke knikker is, moet er natuurlijk een melding in de mail komen. Of misschien op signal, maar dat is een andere blogpost :)
Eens kijken of proton me kan helpen. Ik ben weg bij gmail (of eigenlijk alles van google) dus vandaar proton.
Maar oei oei oei, wat valt dit tegen : Proton ondersteund geen imap of smtp vanwege veiligheid enzo. Leuk, maar ook nergens een vinkje die ik kan aanzetten.
Deze <a href="https://www.vimoire.com/blog/2025-08-17/Setting-up-ProtonMail-Bridge-on-LAN-server">persoon</a> heeft een oplossing, maar die vind ik nu nog een beetje te spannend. Misschien voor later als ik tailscale uitgeprobeerd heb enzo, dat ik die Proton Mail Bridge kan uitproberen.</p>
<blockquote>
<p><em>13-10-2025 Ondertussen heb ik rsync-tasks aan de praat en de meeste data is over. Tijd voor een update</em></p>
</blockquote>
<h3 id="rsyncen">Rsyncen</h3>
<p>Ondertussen heb ik rsync-tasks gemaakt voor iedere shared directory. Met een rsync task hoef ik de terminal niet open te laten
staan om een rsync te doen. Het is mogelijk de rsync-tasks te schedulen met cron, maar ik laat ze disabled zonder schedule.
Aantal settings op de synology :</p>
<p><img src="Content/Blog/media/rsync-aan-op-synology.png" alt="" /></p>
<p>Dan gaan we op OMV een SSH key pair maken :</p>
<p><img src="Content/Blog/media/omv-ssh-keypair.png" alt="" /></p>
<p>Vervolgens kun je deze key installeren op bamischijf :</p>
<p><img src="Content/Blog/media/install-ssh-nasischijf.png" alt="" /></p>
<p>Deze key verschijnt dan in de <code>~/.ssh/authorized_keys</code> op de Synology.
Daarna gaan we een rsync task aanmaken in OMV:</p>
<p><img src="Content/Blog/media/rsync-task.png" alt="" /></p>
<blockquote>
<p>Let op deze enable ik dus niet want ik wil em 1x runnen en daarna wanneer ik dat nodig vindt.</p>
</blockquote>
<p>Het rsyncen kost de synology namelijk behoorlijk wat resources. Tegelijkertijd rsyncen EN jellyfinnen is niet te doen.
Ik moet dus ook het kopieren van de grootste bulk aan data goed plannen. Maar ik moet ook thuis zijn, want ik wil af en toe
voelen hoe warm de USB 3.2 naar 2.5gbps adapters worden...</p>
<blockquote>
<p>_20-10-2025 Okay ik wou dus docker gaan installeren en mn compose files weer up brengen. Maar ik kwam dus eerst iets anders tegen.</p>
</blockquote>
<h3 id="dockeren">Dockeren</h3>
<p>Nu alles zo'n beetje over is qua data, is het zaak dat ik de dockers die we thuis gebruiken, weer aan de praat krijg op nasischijf.
Maar na het installeren van docker had ik gelezen : doe ff reboot als je tegen een vervelende error :</p>
<p><code>permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get &quot;http://%2Fvar%2Frun%2Fdocker.sock/v1.51/containers/json&quot;: dial unix /var/run/docker.sock: connect: permission denied</code></p>
<p>Maar ik had de docker group al gemaakt, $USER aan toegevoegd en permissions gezet, ik kon de docker.sock benaderen. Maar <code>docker ps</code> resulteerde in bovenstaande foutmelding. Dus een reboot.
Toen kon ik OMV niet meer benaderen. Hoe dan?! Dus met het handje de server uitgezet (auw sorry harddisks en andere hardware).  Ik naar boven met de nasischijf, koppelen aan monitor en keyboard.
Start ie in een blauwe prompt met de keuze op memtest! Nee! Dus ik 4x pijltje naar boven de nieuwste kernel kiezen en gaan. Dikke prima niks aan de hand.
Softwarematig de nasischijf weer afgesloten en beneden in kast weer aangesloten. Met de 2.5g usb NIC maar weer geen ping of andere connectie naar nasischijf.
Dus ik weer een herstart doen, maar nu via toetsenbord en de 2.5g usb NIC eruit. Even wachten op numlock. Numlock uit en 4x pijltjetoets naar boven en ENTER.
Et voila! Ik kan weer bij nasischijf :) Okay nog een keer <code>docker ps</code> als mijn user : presto! U gaat door voor de koelkast.</p>
<p>Nu denk ik 2 dingen:</p>
<ol>
<li>Wat ging er mis?</li>
<li>Moet ik een KVM switch?</li>
</ol>
<blockquote>
<p>_25-10-2025 Vandaag weer even tijd. Ik was van plan mijn dockers weer aan de praat te krijgen, maar toen zag ik bovenstaande onopgelost probleem nog staan _</p>
</blockquote>
<h4 id="wat-ging-er-mis">Wat ging er mis?</h4>
<p>Nu weet ik het niet zeker, maar het lijkt er dus op dat ik de proxmox kernel nooit goed heb geinstalleerd of in ieder geval als Default heb gezet.
Ik had dus na het installeren van de proxmox-kernel (die de zfs-tools bevat) deze pve kernel als default moeten zetten.
<img src="Content/Blog/media/system-kernels-pve-set-boot.png" alt="" /></p>
<h4 id="moet-ik-een-kwvm-switch">Moet ik een KWVM switch?</h4>
<p>Nee. Die dingen zijn duur. Ik zou er zelf 1 in elkaar kunnen fabrieken maar dan heb ik een raspberry pi nodig (nog een stroom aansluiting) en nog meer tijd.
Daarbij: zo vaak verwacht ik niet dat ik het grub menu nodig heb. Wel speel ik nog met het idee om een kleine monitor bij een plaatselijke kringloop te scoren.
Ruimte zat waar nasischijf staat. Er ligt ook al een toetsenbord bij. Voor nu is dit van latere zorg. Ik vind het alleen geen prettig idee dat ik de server na een herstart niet kan
benaderen omdat ie blijft hangen in een boot-menu. Op een later tijdstip ga ik me verdiepen in grub menu. Ik wil nu eerst containers heen en weer gooien :)</p>
<h3 id="dockeren-part-deux">Dockeren part deux</h3>
<p>Okay, ik heb dus een /pool/docker waar ik alles van bamischijf heen heb gekopieerd. De docker-compose files heb ik onder mn eigen account op de nasischijf geplaatst.
Mijn plan is om de compose files in de home folder te zetten en de volumes naar /pool/docker te laten wijzen. De compose files die ik niet meer gebruik of nodig heb,
heb ik ondertussen verwijderd. De rest ga ik omsmurfen naar gebruik op nasischijf.</p>
<h4 id="sonarqube">sonarqube</h4>
<p>Ooit ben ik een cicd omgeving gestart met gitlab en jenkins en sonarqube, maar daar is alleen sonarqube van overgebleven.
Tot mijn grote schrik zie ik dat de docker-compose.cicd.yml volumes gebruikt die docker zelf mag bedenken.
Dat wil ik dus niet, ik wil dat ze in /pool/docker komen. Maar dat betekent ook dat ik de volume data van volumes moet kopieren/migreren naar <code>/pool/docker</code>.
Werkt dat uberhaupt? Laten we het uitproberen.</p>
<p>Eerst de <code>docker_*</code> folders overkopieren naar de <code>/pool/docker/</code> op nasischijf. Dit doe ik vanaf bamischijf omdat ik daar root moet zijn om die <code>@docker</code> folder te zien.</p>
<pre><code>rsync -aP docker_* bjdiedering@192.168.100.1:/pool/docker/
</code></pre>
<p>Zodra die folders op de nasischijf staan eerst maar eens een rename, want ik ga geen volledige cicd straat lokaal installeren.</p>
<p><code>mv docker-compose.cicd.yml docker-compose.sonarqube.yml</code></p>
<p>Daarna kijken wat we moeten aanpassen. De volumes moeten expliciet worden genoemd.</p>
<pre><code class="language-yaml">version: &quot;3&quot;

services:
  sonarqube:
    image: sonarqube:lts-community #sonarqube:8.9.3-community
    hostname: sonarqube
    depends_on:
      - db
    environment:
      SONAR_ES_BOOTSTRAP_CHECKS_DISABLE: true
      SONAR_SEARCH_JAVAADDITIONALOPTS: &quot;-Dbootstrap.system_call_filter=false&quot;
      SONAR_JDBC_URL: jdbc:postgresql://db:5432/sonar
      SONAR_JDBC_USERNAME: sonar
      SONAR_JDBC_PASSWORD: sonar
    volumes:
      - sonarqube_data:/opt/sonarqube/data
      - sonarqube_extensions:/opt/sonarqube/extensions
      - sonarqube_logs:/opt/sonarqube/logs
    ports:
      - &quot;9000:9000&quot;
  db:
    image: postgres:13
    environment:
      POSTGRES_USER: sonar
      POSTGRES_PASSWORD: sonar
    volumes:
      - postgresql:/var/lib/postgresql
      - postgresql_data:/var/lib/postgresql/data

volumes:
  sonarqube_data:
  sonarqube_extensions:
  sonarqube_logs:
  postgresql:
  postgresql_data:
</code></pre>
<p>Dat pas ik aan naar dit :</p>
<pre><code class="language-yaml">version: &quot;3&quot;

services:
  sonarqube:
    image: sonarqube:lts-community #sonarqube:8.9.3-community
    hostname: sonarqube
    privileged: true
    depends_on:
      - db
    environment:
      SONAR_ES_BOOTSTRAP_CHECKS_DISABLE: &quot;true&quot;
      SONAR_SEARCH_JAVAADDITIONALOPTS: &quot;-Dbootstrap.system_call_filter=false&quot;
      SONAR_JDBC_URL: &quot;jdbc:postgresql://db:5432/sonar&quot;
      SONAR_JDBC_USERNAME: &quot;sonar&quot;
      SONAR_JDBC_PASSWORD: &quot;sonar&quot;
    volumes:
      - ${DOCKER}/sonarqube/sonarqube_data:/opt/sonarqube/data
      - ${DOCKER}/sonarqube/sonarqube_extensions:/opt/sonarqube/extensions
      - ${DOCKER}/sonarqube/sonarqube_logs:/opt/sonarqube/logs
    ports:
      - &quot;9000:9000&quot;
  db:
    image: postgres:13
    hostname: postgres_sonarqube
    privileged: true
    environment:
      POSTGRES_USER: &quot;sonar&quot;
      POSTGRES_PASSWORD: &quot;sonar&quot;
    volumes:
      - ${DOCKER}/sonarqube/db:/var/lib/postgresql
      - ${DOCKER}/sonarqube/db_data:/var/lib/postgresql/data
</code></pre>
<p>En dan uppen die hap: <code>docker-compose -f docker-compose.sonarqube.yml up -d</code> en nog 9000 als poort allowen : <code>sudo ufw allow 9000</code>
Helaas... een foutmelding :</p>
<pre><code class="language-dockerfile">Recreating docker-db-1 ...

ERROR: for docker-db-1  'ContainerConfig'

ERROR: for db  'ContainerConfig'
Traceback (most recent call last):
  File &quot;/usr/bin/docker-compose&quot;, line 33, in &lt;module&gt;
    sys.exit(load_entry_point('docker-compose==1.29.2', 'console_scripts', 'docker-compose')())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
</code></pre>
<p>Okay misschien dan eens <code>docker compose -f docker-compose.sonarqube.yml up -d</code>
Dat ziet er al beter uit :</p>
<p><img src="Content/Blog/media/dockercompose.png" alt="" /></p>
<p>Maar helaas geen containers up <code>docker ps -a</code> :</p>
<p><img src="Content/Blog/media/docker-ps-a.png" alt="" /></p>
<p>Wat staat er in de logs?</p>
<pre><code>The files belonging to this database system will be owned by user &quot;postgres&quot;.
This user must also own the server process.

The database cluster will be initialized with locale &quot;en_US.utf8&quot;.
The default database encoding has accordingly been set to &quot;UTF8&quot;.
The default text search configuration will be set to &quot;english&quot;.

Data page checksums are disabled.

initdb: error: directory &quot;/var/lib/postgresql/data&quot; exists but is not empty
If you want to create a new database system, either remove or empty
the directory &quot;/var/lib/postgresql/data&quot; or run initdb
with an argument other than &quot;/var/lib/postgresql/data&quot;.
The files belonging to this database system will be owned by user &quot;postgres&quot;.
This user must also own the server process.

The database cluster will be initialized with locale &quot;en_US.utf8&quot;.
The default database encoding has accordingly been set to &quot;UTF8&quot;.
The default text search configuration will be set to &quot;english&quot;.

Data page checksums are disabled.

initdb: error: directory &quot;/var/lib/postgresql/data&quot; exists but is not empty
If you want to create a new database system, either remove or empty
the directory &quot;/var/lib/postgresql/data&quot; or run initdb
with an argument other than &quot;/var/lib/postgresql/data&quot;.
</code></pre>
<p>Na wat verwoede pogingen om dit aan de praat te krijgen ga ik toch maar een backup maken van de huidige database en te
restoren in de nieuwe omgeving. Eerst de bestaande niet opstartende docker containers verwijderen
met <code>docker rm &lt;docker id&gt;</code> en daarna de backup maken van de huidige database van de container op bamischijf :
<code>docker exec 843bf2c6dac8 pg_dump -U sonar -F t sonar &gt; sonarqube.sql</code></p>
<p>En de backup scp-en vanaf bamischijf naar de nasischijf:</p>
<p><code>scp sonarqube.sql bjdiedering@192.168.100.1:/pool/docker/</code></p>
<p>Dan in eerste instantie de docker compose draaien zodat ik een kale/lege sonarqube heb.
Ook de folders leegmaken die ik ga gebruiken voor de volumes, want anders krijg ik weer die initdb error.</p>
<p><code>docker compose -f docker-compose.sonarqube.yml up -d</code></p>
<p>Vervolgens de sonarqube.sql restoren vanuit de database container:</p>
<p><code>docker exec -i a271985fa757 pg_restore -U sonar -d sonar --clean --if-exists &lt; /pool/docker/sonarqube.sql</code></p>
<p>En dan hopen dat alles werkt. En jawel, na inloggen op sonarqube op poort 9000, zie ik mijn projecten weer terug :)</p>
<p><img src="Content/Blog/media/sonarqube-is-up.png" alt="" /></p>
</div>
                <div class="pb-6 pt-6 text-sm text-gray-300"><a target="_blank" rel="noopener noreferrer" href="https://github.com/bruuteuzius/tree/main/Content/Blog/project-bamischijf-2">View on GitHub</a></div></div>
            <footer><div class=" text-sm font-medium leading-5 divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-400">Tags</h2>
                        <div class="flex flex-wrap"><a class="text-primary-500 hover:text-primary-400 mr-3 text-sm font-medium uppercase" href="tags/homelab">homelab</a></div></div></div>
                <div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-400" aria-label="Back to the home" href>‚Üê Back to the home</a></div></footer></div></div></article></main>

        <footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/bruuteuzius"><span class="sr-only">github</span>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-400 h-6 w-6 fill-current text-gray-200"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div>
                <div class="mb-2 flex space-x-2 text-sm text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/BlazorStatic/BlazorStatic"> Built with Blazor Static</a>
                    <div>‚Ä¢</div>
                    <div>¬© 2025</div></div></div></footer></div></div>
        <blazor-focus-on-navigate selector="h1"></blazor-focus-on-navigate></body></html>